<%- include('../partials/mainhead') %>

    <body>
        <div class="container-scroller">
            <!-- partial:../admin_files/partials/_navbar.html -->
            <%- include('../partials/navbar') %>
                <!-- partial -->
                <div class="container-fluid page-body-wrapper">
                    <!-- partial:../admin_files/partials/_settings-panel.html -->
                    <div class="theme-setting-wrapper">
                        <div id="settings-trigger"><i class="ti-settings"></i></div>
                        <div id="theme-settings" class="settings-panel">
                            <i class="settings-close ti-close"></i>
                            <p class="settings-heading">SIDEBAR SKINS</p>
                            <div class="sidebar-bg-options selected" id="sidebar-light-theme">
                                <div class="img-ss rounded-circle bg-light border mr-3"></div>Light
                            </div>
                            <div class="sidebar-bg-options" id="sidebar-dark-theme">
                                <div class="img-ss rounded-circle bg-dark border mr-3"></div>Dark
                            </div>
                            <p class="settings-heading mt-2">HEADER SKINS</p>
                            <div class="color-tiles mx-0 px-4">
                                <div class="tiles success"></div>
                                <div class="tiles warning"></div>
                                <div class="tiles danger"></div>
                                <div class="tiles info"></div>
                                <div class="tiles dark"></div>
                                <div class="tiles default"></div>
                            </div>
                        </div>
                    </div>
                    <div id="right-sidebar" class="settings-panel">
                        <i class="settings-close ti-close"></i>
                        <ul class="nav nav-tabs border-top" id="setting-panel" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="todo-tab" data-toggle="tab" href="#todo-section"
                                    role="tab" aria-controls="todo-section" aria-expanded="true">TO DO LIST</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="chats-tab" data-toggle="tab" href="#chats-section" role="tab"
                                    aria-controls="chats-section">CHATS</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="setting-content">
                            <div class="tab-pane fade show active scroll-wrapper" id="todo-section" role="tabpanel"
                                aria-labelledby="todo-section">
                                <div class="add-items d-flex px-3 mb-0">
                                </div>
                                <div class="list-wrapper px-3">
                                    <ul class="d-flex flex-column-reverse todo-list">
                                        <li>
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="checkbox" type="checkbox">
                                                    Team review meeting at 3.00 PM
                                                </label>
                                            </div>
                                            <i class="remove ti-close"></i>
                                        </li>
                                        <li>
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="checkbox" type="checkbox">
                                                    Prepare for presentation
                                                </label>
                                            </div>
                                            <i class="remove ti-close"></i>
                                        </li>
                                        <li>
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="checkbox" type="checkbox">
                                                    Resolve all the low priority tickets due today
                                                </label>
                                            </div>
                                            <i class="remove ti-close"></i>
                                        </li>
                                        <li class="completed">
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="checkbox" type="checkbox" checked>
                                                    Schedule meeting for next week
                                                </label>
                                            </div>
                                            <i class="remove ti-close"></i>
                                        </li>
                                        <li class="completed">
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="checkbox" type="checkbox" checked>
                                                    Project review
                                                </label>
                                            </div>
                                            <i class="remove ti-close"></i>
                                        </li>
                                    </ul>
                                </div>
                                <h4 class="px-3 text-muted mt-5 font-weight-light mb-0">Events</h4>
                                <div class="events pt-4 px-3">
                                    <div class="wrapper d-flex mb-2">
                                        <i class="ti-control-record text-primary mr-2"></i>
                                        <span>Feb 11 2018</span>
                                    </div>
                                    <p class="mb-0 font-weight-thin text-gray">Creating component page build a js</p>
                                    <p class="text-gray mb-0">The total number of sessions</p>
                                </div>
                                <div class="events pt-4 px-3">
                                    <div class="wrapper d-flex mb-2">
                                        <i class="ti-control-record text-primary mr-2"></i>
                                        <span>Feb 7 2018</span>
                                    </div>
                                    <p class="mb-0 font-weight-thin text-gray">Meeting with Alisa</p>
                                    <p class="text-gray mb-0 ">Call Sarah Graves</p>
                                </div>
                            </div>
                            <!-- To do section tab ends -->
                            <div class="tab-pane fade" id="chats-section" role="tabpanel"
                                aria-labelledby="chats-section">
                                <div class="d-flex align-items-center justify-content-between border-bottom">
                                    <p class="settings-heading border-top-0 mb-3 pl-3 pt-0 border-bottom-0 pb-0">Friends
                                    </p>
                                    <small
                                        class="settings-heading border-top-0 mb-3 pt-0 border-bottom-0 pb-0 pr-3 font-weight-normal">See
                                        All</small>
                                </div>
                                <ul class="chat-list">
                                    <li class="list active">
                                        <div class="profile"><img src="../admin_files/images/faces/face1.jpg"
                                                alt="image"><span class="online"></span></div>
                                        <div class="info">
                                            <p>Thomas Douglas</p>
                                            <p>Available</p>
                                        </div>
                                        <small class="text-muted my-auto">19 min</small>
                                    </li>
                                    <li class="list">
                                        <div class="profile"><img src="../admin_files/images/faces/face2.jpg"
                                                alt="image"><span class="offline"></span></div>
                                        <div class="info">
                                            <div class="wrapper d-flex">
                                                <p>Catherine</p>
                                            </div>
                                            <p>Away</p>
                                        </div>
                                        <div class="badge badge-success badge-pill my-auto mx-2">4</div>
                                        <small class="text-muted my-auto">23 min</small>
                                    </li>
                                    <li class="list">
                                        <div class="profile"><img src="../admin_files/images/faces/face3.jpg"
                                                alt="image"><span class="online"></span></div>
                                        <div class="info">
                                            <p>Daniel Russell</p>
                                            <p>Available</p>
                                        </div>
                                        <small class="text-muted my-auto">14 min</small>
                                    </li>
                                    <li class="list">
                                        <div class="profile"><img src="../admin_files/images/faces/face4.jpg"
                                                alt="image"><span class="offline"></span></div>
                                        <div class="info">
                                            <p>James Richardson</p>
                                            <p>Away</p>
                                        </div>
                                        <small class="text-muted my-auto">2 min</small>
                                    </li>
                                    <li class="list">
                                        <div class="profile"><img src="../admin_files/images/faces/face5.jpg"
                                                alt="image"><span class="online"></span></div>
                                        <div class="info">
                                            <p>Madeline Kennedy</p>
                                            <p>Available</p>
                                        </div>
                                        <small class="text-muted my-auto">5 min</small>
                                    </li>
                                    <li class="list">
                                        <div class="profile"><img src="../admin_files/images/faces/face6.jpg"
                                                alt="image"><span class="online"></span></div>
                                        <div class="info">
                                            <p>Sarah Graves</p>
                                            <p>Available</p>
                                        </div>
                                        <small class="text-muted my-auto">47 min</small>
                                    </li>
                                </ul>
                            </div>
                            <!-- chat tab ends -->
                        </div>
                    </div>
                    <!-- partial -->
                    <!-- partial:../admin_files/partials/_sidebar.html -->
                    <%- include('../partials/sidebar') %>
                        <!-- partial -->
                        <div class="main-panel">
                            <div class="content-wrapper">
                                <div class="row">
                                    <div class="col-md-1">

                                    </div>
                                    <div class="col-md-12 grid-margin stretch-card">
                                        <!-- <div class="card"> -->
                                            <!-- <div class="card-body"> -->
                                                


                                                <div class="col-lg-12 grid-margin stretch-card">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <h4 class="card-title">Category Table</h4>
                                                            <p class="card-description">
                                                                Add Category <code>.table</code>
                                                            </p>
                                                            <div class="table-responsive">
                                                                <table class="table" id="userList">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>order id</th>
                                    <th>payment type</th>
                                    <th>order status</th>
                                    <th>expected delivery</th>
                                    <th>amout</th>
                                    <th>show adress</th>
                                    <th>view</th>
                                    <th>edit status</th>
                                   
                                                                        </tr>
                                                                    </thead>
                                                                    <% checkout.forEach(checkouts => { %>
                                                                        <tr id="row<%=checkouts._id%>">
                                                                               <td>
                                                                                <%=checkouts._id%> 
                                                                               </td>
                                                                               <td>
                                                                                <%=checkouts.paymentStatus%> 
                                                                               </td>
                                                                               <% checkouts.orderStatus.forEach(orderStats => { %>
                                                                               <td id="id<%=checkouts._id%>">
                                                                                <%=orderStats.type%> 
                                                                               </td>
                                                                               <%});%> 
                                                                              
                                                                               <td>
                                                                                 <%let deliveryDate =checkouts.expectedDate%>
                                                                                <% deliveryDate = deliveryDate.toLocaleDateString(); %> 
                                                                              <%=deliveryDate%>
                                                                               </td>
                                                                               <td>
                                                                                <%=checkouts.bill%> 
                                                                               </td>
                                                                               <td>
                                                                                <button class="btn btn-danger"   onclick="address('<%=checkouts._id%>')" data-toggle="modal"
                                                                                    data-target="#exampleModalCenter2" >address</button>   
                                                                               </td>
                                                                               <td>
                                                                                <button class="btn btn-success"   onclick="show('<%=checkouts._id%>')" data-toggle="modal"
                                                                                  data-target="#exampleModalCenter1" >view</button>                                                                              
                                                                               </td>
                                                                               <td>
                                                                                <button class="btn btn-primary"   onclick="edit('<%=checkouts._id%>')" data-toggle="modal"
                                                                                    data-target="#exampleModalCenter" >status</button>
                                                                               </td>
                                                                            </tr>
                                                                           
                                                                            <%});%>          
                                                                        </tbody>
                                                                </table>
                                                           
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            <!-- </div> -->
                                        <!-- </div> -->
                                    </div>

                                </div>
                            </div>

                            <div class="modal fade" id="exampleModalCenter1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-l"  role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalCenterTitle">orderd products</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                      <div class="table-responsive" id="table_main">
                                    </div>
                                      
                                     
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                                      
                                    </div>
                                </div>
                            </div>
                                      </div>

                            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-l"  role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalCenterTitle">orderd products</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                    <label>update order status</label> 
                                    <select class="custom-select my-1 mr-sm-2" id="selectbox">
                                        <option selected>ordered</option>
                                        <option value="packed">packed</option>
                                        <option value="shipped">shipped</option>
                                        <option value="delivered">delivered</option>
                                        <option value="canceled">canceled</option>
                                      </select>
                                    </div>
                                    <div class="modal-footer">
                                        
                                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" onclick="save()">save</button>
                                      
                                    </div>
                                </div>
                            </div>
                                      </div>

                            <div class="modal fade" id="exampleModalCenter2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-l"  role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalCenterTitle">orderd products</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                      <div class="table-responsive" id="address">
                                    </div>
                                      
                                     
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                                      
                                    </div>
                                </div>
                            </div>
                                      </div>
                            <!-- content-wrapper ends -->
                            <!-- partial:../admin_files/partials/_footer.html -->
                            <footer class="footer">
                                <div class="d-sm-flex justify-content-center justify-content-sm-between">
                                    <span
                                        class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright
                                        ©
                                        2021.
                                        Premium <a href="https://www.bootstrapdash.com/" target="_blank">Bootstrap admin
                                            template</a> from BootstrapDash. All rights reserved.</span>
                                    <span
                                        class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Hand-crafted
                                        &
                                        made
                                        with <i class="ti-heart text-danger ml-1"></i></span>
                                </div>
                            </footer>
                            <!-- partial -->
                        </div>
                        <!-- main-panel ends -->
                </div>
                <!-- page-body-wrapper ends -->
        </div>
<script>
    function show(checkoutId){
     const image = document.getElementById('pro_img')
     const productName = document.getElementById('product_name')
     const tableMain = document.getElementById('table_main')
    // console.log(checkoutId)
      fetch('/admin/order/view', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ checkoutId })
        }).then(res => res.json()).then(data => {
        //   console.log(tableMain)
          // image.innerHTML=''
          let table = `<table class="table table-striped table-hover"><thead><tr><th>product</th>
            <th>product name</th>
            <th>product price</th>
            <th>quantity</th>
            </tr><thead><tbody>`
          data.checkout.forEach(checkouts=>{
       
            checkouts.products.forEach(product=>{
           
             console.log(product)
             console.log(product.image[0].url)
             table+= `<tr><td><div class="mb-3" style="background-image:url(${product.image[0].url}); width:50px;height:50px;background-size:cover;background-repeat:no-repeat "></div></td>
              <td>${product.product_name}</td>
              <td>₹${product.price}</td>
              <td>${checkouts.product_quantity}</td></tr>`
            //  image.innerHTML += `<div class="mb-3" style="background-image:url(${product.image[0].url}); width:50px;height:50px;background-size:cover;background-repeat:no-repeat "></div>`;
            //  image.innerHTML +=   `<div>${product.product_name}</div>` 
            })
          })
        // console.log(tableMain)
        table+=`</tbody></table>`
         tableMain.innerHTML = table
            
        })
    }
    
    const tap =  document.getElementById('selectbox')
  
     function edit(checkoutId){
        let change = document.getElementById('id'+checkoutId)
      tap.addEventListener ('change',async()=>{
        let result = tap.value
        document.getElementById('table_status')
        // console.log(table_status)
        fetch('/admin/order/edit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ checkoutId,result })
        }).then(res => res.json()).then(data => {
            const checkout = data.checkout
            
            checkout.orderStatus.forEach  (checkouts => { 
                const final = checkouts.type
                change.innerHTML= final
                location.reload(change)
            })
           
    })  
    })
    }
    let address1 = document.getElementById('address')
    // console.log(address1)
    function address(checkoutId){
        fetch('/admin/order/address', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ checkoutId})
        }).then(res => res.json()).then(data => {
            // const checkout = data.checkout
            // console.log(data)
          address1.innerHTML =`<div>name:${data.checkout.address.name}<br>
            <div><small>mobile:${data.checkout.address.mobile}</small><br>
                <div><small>email:${data.checkout.address.email}</small><br>
                    <div>${data.checkout.address.address_line}<br>
                    </div>`

        //  console.log(address_line);  
    })  
    }
</script>
<script type="text/javascript" charset="utf8"
    src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.2.min.js"></script>
<script type="text/javascript" charset="utf8"
    src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
<script>
    $(function () {
        $("#userList").dataTable();
    });
</script>
        <!-- container-scroller -->
        <!-- plugins:js -->
        <%- include('../partials/end') %>